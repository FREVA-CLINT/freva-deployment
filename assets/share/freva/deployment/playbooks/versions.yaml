---
- hosts: databrowser
  vars:
    ansible_become_user: "{{ databrowser_ansible_become_user | default('root') }}"
    use_become: "{{ databrowser_ansible_become_user is defined and databrowser_ansible_become_user != '' }}"
  tasks:
    - name: Get databrowserAPI version
      tags: databrowser
      ansible.builtin.script:
        cmd: "{{ asset_dir }}/scripts/inspect.sh ghcr.io/freva-clint/databrowserapi"
      become: "{{use_become}}"
    - name: Get apache solr version
      tags: solr
      ansible.builtin.script:
        cmd: "{{ asset_dir }}/scripts/inspect.sh solr"
      become: "{{use_become}}"
- hosts: web
  vars:
    ansible_become_user: "{{ web_ansible_become_user | default('root') }}"
    use_become: "{{ web_ansible_become_user is defined and web_ansible_become_user != '' }}"
  tasks:
    - name: Get web version
      tags: web
      ansible.builtin.script:
        cmd: "{{ asset_dir }}/scripts/inspect.sh ghcr.io/freva-clint/freva-web"
      become: "{{use_become}}"
- hosts: vault
  vars:
    ansible_become_user: "{{ db_ansible_become_user | default('root') }}"
    use_become: "{{ db_ansible_become_user is defined and db_ansible_become_user != '' }}"
  tasks:
    - name: Get vault version
      tags: vault
      ansible.builtin.script:
        cmd: "{{ asset_dir }}/scripts/inspect.sh ghcr.io/freva-clint/freva-deployment/vault"
      become: "{{use_become}}"
- hosts: core
  vars:
    freva_bin: "{{ core_install_dir | expanduser }}/bin/freva"
  tasks:
    - name: Get freva version
      tags: freva
      shell: "{{freva_bin}} -V 2> /dev/null |awk '{print $NF}'"
