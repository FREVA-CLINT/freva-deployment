---
- hosts: databrowser
  tasks:
    - name: Get databrowserAPI version
      register: databrowser
      ansible.builtin.script:
        cmd: "{{ asset_dir }}/scripts/inspect.sh ghcr.io/freva-clint/databrowserapi"
      become: "{{ databrowser_ansible_become_user | default('root') is defined and databrowser_ansible_become_user | default('root') != '' }}"
    - name: Display databrowser version
      debug:
        msg: "{{ databrowser.stdout }}"
    - name: Get apache solr version
      register: solr
      ansible.builtin.script:
        cmd: "{{ asset_dir }}/scripts/inspect.sh solr"
      become: "{{ databrowser_ansible_become_user | default('root') is defined and databrowser_ansible_become_user | default('root') != '' }}"
      when: inventory_hostname in groups['databrowser']
    - name: Display solr version
      debug:
        msg: "{{ solr.stdout }}"
- hosts: web
  tasks:
    - name: Get web version
      register: web
      ansible.builtin.script:
        cmd: "{{ asset_dir }}/scripts/inspect.sh ghcr.io/freva-clint/freva-web"
      become: "{{ web_ansible_become_user | default('root') is defined and web_ansible_become_user | default('root') != '' }}"
      when: inventory_hostname in groups['web']
- hosts: db
  tasks:
    - name: Get vault version
      register: vault
      ansible.builtin.script:
        cmd: "{{ asset_dir }}/scripts/inspect.sh ghcr.io/freva-clint/freva-deployment/vault"
      become: "{{ db_ansible_become_user | default('root') is defined and db_ansible_become_user | default('root') != '' }}"
      when: inventory_hostname in groups['vault']
    - name: Display vault version
      debug:
        msg: "{{ vault.stdout }}"
- hosts: core
  tasks:
    - name: Get freva version
      register: core
      tags: core
      shell:
        cmd: "{{ core_install_dir | expanduser }}/bin/freva -V 2> /dev/null | awk '{print $NF}'"
      when: inventory_hostname in groups['core']
    - name: Display core version
      debug:
        msg: "{{ core.stdout }}"
